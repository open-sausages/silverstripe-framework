---
Name: assetstore
---
Injector:
  # Public url plugin
  FlysystemUrlPlugin:
    class: 'SilverStripe\Filesystem\Flysystem\FlysystemUrlPlugin'
  # Define the default adapter for this filesystem
  FlysystemDefaultAdapter:
    class: 'SilverStripe\Filesystem\Flysystem\AssetAdapter'
  # Define the secondary adapter for secure assets
  FlysystemSecureAdapter:
    class: 'SilverStripe\Filesystem\Flysystem\SecureAssetAdapter'
  # Define the default filesystem
  FlysystemBackend:
    class: 'League\Flysystem\Filesystem'
    constructor:
      Adapter: '%$FlysystemDefaultAdapter'
      Config:
        visibility: public
    calls:
      PublicURLPlugin: [ addPlugin, [ %$FlysystemUrlPlugin ] ]
  # Define the secondary filesystem for secured assets
  FlysystemSecureBackend:
    class: 'League\Flysystem\Filesystem'
    constructor:
      Adapter: '%$FlysystemSecureAdapter'
      Config:
        visibility: private
    calls:
      PublicURLPlugin: [ addPlugin, [ %$FlysystemUrlPlugin ] ]
  # Define our SS asset backend
  AssetStore:
    class: 'SilverStripe\Filesystem\Flysystem\FlysystemAssetStore'
    properties:
      Filesystem: '%$FlysystemBackend'
      SecureFilesystem: '%$FlysystemSecureBackend'
  AssetNameGenerator:
    class: SilverStripe\Filesystem\Storage\DefaultAssetNameGenerator
    type: prototype
  # Image mechanism
  Image_Backend: GDBackend
  # Requirements config
  GeneratedAssetHandler:
    class: SilverStripe\Filesystem\Storage\FlysystemGeneratedAssetHandler
    properties:
      Filesystem: '%$FlysystemBackend'
  Requirements_Minifier:
    class: SilverStripe\View\JSMinifier
  Requirements_Backend:
    properties:
      AssetHandler: '%$GeneratedAssetHandler'
